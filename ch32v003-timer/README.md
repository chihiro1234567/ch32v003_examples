# CH32V003 Timer

## How to build and execute

```bash
> make clean && make && ../ch32v003fun/minichlink/minichlink -T
:
TIMER2 ISR 3429655354, 0
TIMER2 ISR 3431699596, 0
TIMER2 ISR 3433699721, 0
TIMER1 ISR 3435655472, 0
TIMER2 ISR 3435699845, 0
TIMER2 ISR 3437699970, 0
TIMER2 ISR 3439700095, 0
TIMER1 ISR 3441655597, 0
:
```

CH32V003には、**Advanced-control timer**と**General-purpose timer**がそれぞれ1個ずつあり、
独立して動作する物理的なタイマが2個あるということ。

## Advanced Control Timer (ADTM, アドバンストタイマー)

* 16ビットの自動ロードアップ/ダウンカウンター。
* 16ビットのプログラマブルプリスケーラを備えている。
* 6つのチャンネルに分散された三相PWMジェネレーターと見なすことができる。
* デッドゾーン挿入付きの補完PWM出力機能を持つ。
* タイマーを指定されたカウンターサイクルの後に更新してカウントサイクルを繰り返すことができる。
* ブレーキ機能など多くの機能を提供。
* 各タイマーには独立したDMAリクエストメカニズムがあり、割込みとかもDMAを使う。
* TIM1のレジスタ一覧は、Table 10-3 TIM1-related registers list参照

リファレンスの**Chapter 10 Advanced-control Timer (ADTM)**参照

## General Purpose Timer (GPTM, 汎用タイマー)

* 16ビットまたは32ビットの自動ロードアップ/ダウンカウンター。
* プログラム可能な16ビットのプリスケーラを持つ。
* 4つの独立したチャンネルを持つ。
* 入力キャプチャ、出力比較、PWM生成、シングルパルスモード出力をサポート。
* タイマーリンク機能を介して高度な制御タイマーと協力して、同期やイベントリンクの機能を提供。
* デバッグモードでは、PWM出力を無効にしてカウンターをフリーズできる。
* 任意の汎用タイマーを使用してPWM出力を生成可能。
* 各タイマーには独立したDMAリクエストメカニズムがあり、割込みとかもDMAを使う。
* 増分エンコーダからの信号や1から3のホールセンサーからのデジタル出力を処理可能。
* TIM2のレジスタ一覧は、Table 11-3 TIM2-related registers list参照

リファレンスの**Chapter 11 General-purpose Timer (GPTM)**参照


## 汎用タイマとアドバンスト制御タイマの違い

汎用タイマは、アドバンスド・コントロール・タイマと比較して、以下の特徴がない。
1. 汎用タイマには、コアカウンタのカウントサイクルをカウントするための繰り返しカウントレジスタがない。
2. 汎用タイマの比較キャプチャ・チャネルにはデッドバンドがなく、相補出力がない。
3. 汎用タイマにはブレーキ信号機構がない。

基本的な精度や機能は同じ。モーター制御や高度なPWM、空いているならADTM（TIM1）で、そうじゃない場合、TIM1使っているならGPTM（TIM2）。
今のところはそれぐらいの認識。


